<!DOCTYPE html>
<html>
	<head>
		<style>
		</style>
	</head>
	<body>
		<canvas width="200" height="280" id="paint_area">
			<img id="treble" src="treble.gif" />
			<img id="bass" src="bass_clef_xxl.png" />
		</canvas><br />
		<button onclick="flashCards.refresh();" value="refresh">refresh</button>
		<script>
			window.flashCards = {
				canvas:{
					dom:null,
					color:'#EEEEEE',
					height:500,
					width:500				
				},
				staff:{
					shortLines:{
						startX:120,
						stopX:180,
						number: 2
					},
					lines:{
						startX:0,
						stopX:375
					},
					startY:25.5,
					stopY:250,
					spacing:25,
					color:"#333"
				},
				
				init: function(){
					flashCards.canvas.dom = document.getElementById('paint_area').getContext('2d');
					flashCards.refresh();
				},
				resetCanvas: function(){
					var cvs, props, staff, shortLines, lines;
					props = flashCards.canvas;
					cvs = props.dom;
					staff = flashCards.staff;
					shortLines = staff.shortLines;
					lines = staff.lines;
					
					//create and fill the rectangle
					cvs.fillStyle = props.color;
					cvs.fillRect(0,0,props.height,props.width);
					
					cvs.beginPath();
					//make the staff lines
					for (var y = staff.startY, l = 1; y < staff.stopY; y += staff.spacing, l++) {
						//account for outer lines
						if(l <= shortLines.number || l > (shortLines.number + 5)){
							//we only want these lines to be long enough to hold the note. They shouldn't stretch across the whole screen
							cvs.moveTo(shortLines.startX, y);
							cvs.lineTo(shortLines.stopX, y);
						}else{
							cvs.moveTo(lines.startX, y);
							cvs.lineTo(lines.stopX, y);
						}
					}
					cvs.strokeStyle = staff.color;
					cvs.stroke();
					cvs.closePath();
					
					return cvs;					
				},
				notes:{
					x:150,
					spacing:12.5,
					radius:15,
					sA:0,/*idk what sA stands for...*/
					eA:Math.PI * 2,/*idk what eA stands for...*/
					acw:false,/*idk what acw stands for...*/
					color:"#000",
					list:[
						{steps:1, treble:{note:"D",answered:0}, bass:{note:"F",answered:0}},
						{steps:2, treble:{note:"C",answered:0}, bass:{note:"E",answered:0}},
						{steps:3, treble:{note:"B",answered:0}, bass:{note:"D",answered:0}},
						{steps:4, treble:{note:"A",answered:0}, bass:{note:"C",answered:0}},
						{steps:5, treble:{note:"G",answered:0}, bass:{note:"B",answered:0}},
						{steps:6, treble:{note:"F",answered:0}, bass:{note:"A",answered:0}},
						{steps:7, treble:{note:"E",answered:0}, bass:{note:"G",answered:0}},
						{steps:8, treble:{note:"D",answered:0}, bass:{note:"F",answered:0}},
						{steps:9, treble:{note:"C",answered:0}, bass:{note:"E",answered:0}},
						{steps:10, treble:{note:"B",answered:0}, bass:{note:"D",answered:0}},
						{steps:11, treble:{note:"A",answered:0}, bass:{note:"C",answered:0}},
						{steps:12, treble:{note:"G",answered:0}, bass:{note:"B",answered:0}},
						{steps:13, treble:{note:"F",answered:0}, bass:{note:"A",answered:0}},
						{steps:14, treble:{note:"E",answered:0}, bass:{note:"G",answered:0}},
						{steps:15, treble:{note:"D",answered:0}, bass:{note:"F",answered:0}},
						{steps:16, treble:{note:"C",answered:0}, bass:{note:"E",answered:0}},
						{steps:17, treble:{note:"B",answered:0}, bass:{note:"D",answered:0}},
						{steps:18, treble:{note:"A",answered:0}, bass:{note:"C",answered:0}},
						{steps:19, treble:{note:"G",answered:0}, bass:{note:"B",answered:0}}
					]
				},
				noteLetter:{
					color:"#000",
					font:"bold 30px sans-serif",
					x:10,/*text x,y represents bottom left, NOT top left*/
					y:275,
					backgroundSquare:{
						x:5,
						y:245,
						width:35,
						height:35
					}
				},
				clefs : [
					{name:"treble", x:10, y:50, width:50, height:175},
					{name:"bass", x:10, y:75, width:60, height:87}
				],
				/*redraw the notes. This needs a lot of clean up and abstraction still*/
				refreshNotes: function(){
					var cvs, notes, note, clef, clefDOM;
					cvs = flashCards.canvas.dom;
					notes = flashCards.notes;
					
					//start a new path to make the notes with
					cvs.beginPath();
	
					//draw a random note
					note = notes.list[(Math.floor(Math.random() * notes.list.length))];
					cvs.arc(notes.x, (notes.spacing * note.steps), notes.radius, notes.sA, notes.eA, notes.acw);
					cvs.closePath();
					cvs.strokeStyle = notes.color;
					cvs.stroke();
					cvs.fillStyle = notes.color;
					cvs.fill();
	

	
					//draw one random clef
					clef = flashCards.clefs[(Math.floor(Math.random() * flashCards.clefs.length))];
					console.log("clefname:" + clef.name);
					clefDOM = document.getElementById(clef.name);
					cvs.drawImage(clefDOM, clef.x, clef.y, clef.width, clef.height);
	
					cvs.canvas.addEventListener('mousedown', function() {
						var letter, bg;
						letter = flashCards.noteLetter;
						bg = letter.backgroundSquare;
						
						//Draw the note letter associated with randomly chosen note
						cvs.fillStyle = flashCards.canvas.color;
						cvs.fillRect(bg.x,bg.y,bg.width,bg.height);
						cvs.font = letter.font;
						cvs.fillStyle = letter.color;
						cvs.fillText(note[clef.name].note, letter.x, letter.y);
					}, false);
					cvs.canvas.addEventListener('mouseup', function() {
	
					}, false);					
				},
				refresh:function(){
					flashCards.resetCanvas();
					flashCards.refreshNotes();
				}
			};
			
			flashCards.init();
		</script>

	<!-- http://diveintohtml5.org/canvas.html#divingin -->
	<!-- http://playground.html5rocks.com/#canvas_tag -->
	</body>
</html>